tasks:
  exec:
    interactive: true
    parameters:
    - name: exec_dir
      type: string
      default: ""
    - name: subdir
      type: string
      default: ""
    - name: title
      type: string
      default: "CMD"
    - name: cmd
      type: string
      default: "pwd"
    - name: mode
      type: string
      default: default
    - name: flags
      type: string
      default: ""
    - name: verbose
      type: string
      default: "true"
    steps:
    - script: |
        if [ "{{ .mode }}" = "default" ]; then
          CMD={{ list .flags .cmd | join " " | trimSuffix "\n" | trim | quote | replace "\\n" "\n" }}

          if [ "{{.verbose}}" = "true" ]; then
            MESSAGE="---> {{ .title }} :: Executing command:"
            echo -e "\033[0;34m${MESSAGE}\033[0m"
          fi

          echo -e "\033[0;32m${CMD}\033[0m"
          set -e;
          {{list .flags .cmd | join " "}}
        fi

  git-secret:
    parameters:
    - name: secret_file
      type: string
    tasks:
      hide:
        steps:
        - task: exec
          arguments:
            title: "Git secret :: Hide secret"
            cmd: |
              git secret hide {{ .secret_file }}
      reveal:
        steps:
        - task: exec
          arguments:
            title: "Git secret :: Reveal secret"
            cmd: |
              git secret reveal -f {{ .secret_file }}
      delete:
        steps:
        - task: exec
          arguments:
            title: "Git secret :: Remove secret file"
            cmd: |
              rm {{ .secret_file }}

  gpg:
    bindParamsFromEnv: true
    parameters:
    - name: TOOLBOX_GPG_KEY_FILE_PATH
      type: string
    tasks:
      import_key:
        steps:
        - task: exec
          arguments:
            title: "GPG :: Import key"
            cmd: |
              gpg --batch --import {{ .TOOLBOX_GPG_KEY_FILE_PATH }}

