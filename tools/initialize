#!/usr/bin/env variant
# vi: ft=yaml

import: /toolbox/variant-lib/utils.yaml

description: Toolbox initialization

parameters:
- name: TOOLBOX_DEPS_DIR
  default: toolbox/.toolbox/deps
- name: TOOLBOX_BOILERPLATE_ADDRESS
  default: github.com/aroq/toolbox-boilerplate?ref=v0.1.4

steps:
- task: exec
  arguments:
    title: Toolbox initialize
    cmd: |
      rm -fR tooolbox/.toolbox/deps

      go-getter github.com/aroq/toolwrap?ref=v0.1.8 "{{ .TOOLBOX_DEPS_DIR }}/toolwrap"
      rm -fR "{{ .TOOLBOX_DEPS_DIR }}/toolwrap/.git"

      go-getter github.com/aroq/toolbox-variant?ref=v0.1.2 "{{ .TOOLBOX_DEPS_DIR }}/toolbox-variant"
      rm -fR "{{ .TOOLBOX_DEPS_DIR }}/toolbox-variant/.git"

      go-getter "{{ .TOOLBOX_BOILERPLATE_ADDRESS }}" "{{ .TOOLBOX_DEPS_DIR }}/toolbox-boilerplate"
      rm -fR "{{ .TOOLBOX_BOILERPLATE_ADDRESS }}" "{{ .TOOLBOX_DEPS_DIR }}/toolbox-boilerplate/.git"

      rsync -r --exclude=".git" --ignore-existing "{{ .TOOLBOX_DEPS_DIR }}/toolbox-boilerplate/." toolbox/
      rm -fR "{{ .TOOLBOX_DEPS_DIR }}/toolbox-boilerplate"

- task: exec
  arguments:
    title: Toolbox initialize
    cmd: |
      /toolbox/tools/toolbox cmd create
